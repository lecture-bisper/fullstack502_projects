<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>spring project Scene, Share</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
          crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/css/common.css">
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <script src="/js/common.js" defer></script>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script>
    // ✅ 반응형 + 오버플로우 감지 + 부드러운 슬라이드
    document.addEventListener('DOMContentLoaded', function () {
      const base = (next, prev) => ({
        spaceBetween: 16,
        speed: 500,
        watchOverflow: true,           // ✅ 슬라이드 개수가 적으면 자동 비활성
        navigation: { nextEl: next, prevEl: prev },
        breakpoints: {                 // ✅ 반응형 slidesPerView
          0:   { slidesPerView: 2 },
          576: { slidesPerView: 3 },
          768: { slidesPerView: 4 },
          992: { slidesPerView: 5 }
        },
        keyboard: { enabled: true },
        // 원하면 자동 슬라이드도:
        // autoplay: { delay: 2500, disableOnInteraction: false },
      });

      const swiper1 = new Swiper('.listSwiper1', base('.list-btn-next1', '.list-btn-prev1')); // 가장 많이 찾는 영화
      const swiper2 = new Swiper('.listSwiper2', base('.list-btn-next2', '.list-btn-prev2')); // 최신 영화
    });
  </script>
</head>
<body>
<div class="wrap">

  <!-- ✅ 수정: 타임리프 프래그먼트 경로에서 선행 슬래시 제거 -->
  <header th:replace="~{user/layout/header :: headerBasic('main')}"></header>

  <main>
    <div class="container">
      <section class="main-sec1">
        <div class="title">
          <h4>가장 많이 찾는 영화</h4>
          <a href="/main/movieListBookmarkCnt" th:href="@{/main/movieListBookmarkCnt}">더보기</a>
        </div>

        <!-- 데이터가 없는 경우 -->
        <div class="none main-page" th:unless="${#lists.size(movieListBookmarkCnt)} > 0">등록된 영화가 없습니다.</div>

        <div class="swiper-wrap">
          <div class="swiper listSwiper1">
            <div class="movie-list swiper-wrapper">
              <div class="movie-box swiper-slide" th:if="${#lists.size(movieListBookmarkCnt)} > 0"
                   th:each="item, iter : ${movieListBookmarkCnt}">
                <div class="movie-img">
                  <a th:href="@{/movieDetail/{id}(id=${item.movieId})}">
                    <figure th:with="posterUrl=${#strings.isEmpty(item.moviePosterUrl) ? '/img/no-image.svg' : item.moviePosterUrl}">
                      <img src="/img/no-image.svg" th:src="@{${posterUrl}}" alt="영화 포스터">
                    </figure>
                  </a>
                  <button type="button" class="bookmark">
                    <span class="heart">보고싶어요</span>
                    <span class="count" th:text="${item.bookmarkCnt}">0</span>
                  </button>
                </div>
                <div class="movie-title">
                  <p class="sTitle" th:text="${item.movieTitle}">영화제목</p>
                  <p class="gpa">
                    평점<img src="/img/star_icon.svg" alt="star_icon">
                    <em th:text="${item.movieRatingAvg}">0</em>
                  </p>
                </div>
              </div>

            </div>
          </div>

          <div class="swiper-btn list-btn-next1 swiper-button-next"></div>
          <div class="swiper-btn list-btn-prev1 swiper-button-prev"></div>
        </div>
      </section>

      <section class="main-sec2">
        <div class="title">
          <h4>최신 영화</h4>
          <a href="/main/movieListReleaseDate" th:href="@{/main/movieListReleaseDate}">더보기</a>
        </div>

        <!-- 데이터가 없는 경우 -->
        <div class="none main-page" th:unless="${#lists.size(movieListReleaseDate)} > 0">등록된 영화가 없습니다.</div>

        <div class="swiper-wrap">
          <div class="swiper listSwiper2">
            <div class="movie-list swiper-wrapper">
              <div class="movie-box swiper-slide" th:if="${#lists.size(movieListReleaseDate)} > 0" th:each="item : ${movieListReleaseDate}">
                <div class="movie-img">
                  <a href="#" th:href="@{|/movieDetail/${item.movieId}|}">
                    <figure th:with="posterUrl=${#strings.isEmpty(item.moviePosterUrl) ? '/img/no-image.svg' : item.moviePosterUrl}">
                      <img src="/img/no-image.svg" th:src="@{${posterUrl}}" alt="">
                    </figure>
                  </a>
                  <button type="button" class="bookmark">
                    <span class="heart">보고싶어요</span>
                    <span class="count" th:text="${item.bookmarkCnt}">0</span>
                  </button>
                </div>
                <div class="movie-title">
                  <p class="sTitle" th:text="${item.movieTitle}">영화제목</p>
                  <p class="gpa">
                    평점<img src="/img/star_icon.svg" alt="star_icon">
                    <em th:text="${item.movieRatingAvg}">0</em>
                  </p>
                </div>
              </div>

            </div>
          </div>

          <div class="swiper-btn list-btn-next2 swiper-button-next"></div>
          <div class="swiper-btn list-btn-prev2 swiper-button-prev"></div>
        </div>

      </section>

      <section class="main-sec3">
        <div class="title">
          <h4>개봉 예정작</h4>
          <a href="#">더보기</a>
        </div>

        <div class="movie-list">
          <div class="movie-box">
            <div class="movie-img">
              <a href="#">
                <figure>
                  <!-- ✅ 수정: 상대경로 -> 정적 리소스 경로로 안전화 -->
                  <img th:src="@{/img/test6-img.jpg}" alt="">
                </figure>
              </a>
              <button type="button" class="bookmark">
                <span class="heart">보고싶어요</span>
                <span class="count">0</span>
              </button>
            </div>
            <div class="movie-title">
              <p class="sTitle">좀비딸</p>
              <p class="open-date">2025.07.30</p>
            </div>
          </div>

          <div class="movie-box">
            <div class="movie-img">
              <a href="#">
                <figure>
                  <!-- ✅ 수정: 상대경로 -> 정적 리소스 경로로 안전화 -->
                  <img th:src="@{/img/test7-img.jpg}" alt="">
                </figure>
              </a>
              <button type="button" class="bookmark">
                <span class="heart">보고싶어요</span>
                <span class="count">0</span>
              </button>
            </div>
            <div class="movie-title">
              <p class="sTitle">전지적 독자 시점</p>
              <p class="open-date">2025.07.30</p>
            </div>
          </div>

        </div>
      </section>

      <section class="main-sec4 page-bottom">
        <div class="title">
          <h4>영화 추천 리뷰</h4>
          <a th:href="@{/main/boardList}">더보기</a>
        </div>

        <!-- 리뷰가 없는 경우 -->
        <div class="none"
             th:unless="${boardList != null and !#lists.isEmpty(boardList)}">
          작성된 리뷰가 없습니다.
        </div>

        <!-- 카드 리스트 (UI 클래스 유지) -->
        <div class="review-list"
             th:if="${boardList != null and !#lists.isEmpty(boardList)}">

          <div class="review-box"
               th:each="item : ${boardList}"
               th:with="
            poster=${#strings.isEmpty(item.posterUrl) ? '/img/no-image.png' : item.posterUrl},
            full=${T(java.lang.Math).floor(item.rating)},
            half=${(item.rating - T(java.lang.Math).floor(item.rating)) >= 0.5 ? 1 : 0}
         ">
            <a th:href="@{/user/boardDetail/{boardId}(boardId=${item.boardId})}">
              <div class="top">
                <h6>
                  <!-- 유저 이미지(없으면 기본) -->
                  <img th:if="${item.userImg != null}"
                       th:src="@{'/img/profile/' + ${item.userImg}}"
                       class="profile-img" alt="profile">
                  <img th:unless="${item.userImg != null}"
                       th:src="@{/img/profile_img_bg.svg}"
                       class="profile-img" alt="profile">

                  <span th:text="${item.userId}">userId</span>
                </h6>

                <!-- 별점: full / half / grey -->
                <div class="star-view">
                  <img th:each="i : ${#numbers.sequence(1, full)}"
                       src="/img/star_yellow_icon.svg" alt="">
                  <img th:if="${half == 1}" src="/img/star_half_icon.svg" alt="">
                  <img th:each="i : ${#numbers.sequence(1, 5 - full - half)}"
                       src="/img/star_grey_icon.svg" alt="">
                </div>
              </div>

              <div class="center">
                <figure class="imgBox">
                  <img th:src="${poster}" alt="">
                </figure>
                <div class="infor">
                  <h5 class="in-title" th:text="${item.movieTitle}">영화제목</h5>
                  <p class="in-text" th:text="${item.contents}"></p>
                </div>
              </div>

              <div class="bottom">
                댓글 <em th:text="${item.commentCount}">0</em>
                ·
                <span th:text="${#temporals.format(item.createDate, 'yyyy.MM.dd HH:mm')}">2025.10.10 19:30</span>
              </div>
            </a>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- ✅ 수정: 타임리프 프래그먼트 경로에서 선행 슬래시 제거 -->
  <footer th:replace="~{user/layout/footer :: footer}"></footer>

</div>
</body>
</html>

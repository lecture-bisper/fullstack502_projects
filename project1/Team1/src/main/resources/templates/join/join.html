<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원가입</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/pretendard.css">
  <link th:href="@{/css/style.css}" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="/js/script.js"></script>

  <script>
    $(document).ready(function () {
      let isIdChecked = false;

      $('.inc_id, .co_id').hide();
      // 비밀번호 일치 여부 체크
      $('.inc_pw, .co_pw').hide();
      $('.ori_pw, .chk_pw').on('keyup', function () {
        const pw = $('.ori_pw').val();
        const pwChk = $('.chk_pw').val();

        if (pw === '' || pwChk === '') {
          $('.inc_pw').hide();
          $('.co_pw').hide();
        } else if (pw === pwChk) {
          $('.co_pw').show();
          $('.inc_pw').hide();
        } else {
          $('.co_pw').hide();
          $('.inc_pw').show();
        }
      });

      // 아이디 중복 확인 버튼 클릭 시
      $('.chk_id_btn').on('click', function () {
        const inputId = $('.chk_id').val().trim();

        if (inputId === '') {
          alert('아이디를 입력해주세요!');
          $('.inc_id').hide();
          $('.co_id').hide();
          isIdChecked = false;
          return;
        }

        $.ajax({
          url: '/idCheck',
          method: 'GET',
          data: { customerId: inputId },
          success: function (res) {
            if (res.duplicate) {
              $('.inc_id').show();
              $('.co_id').hide();
              isIdChecked = false;
            } else {
              $('.inc_id').hide();
              $('.co_id').show();
              isIdChecked = true;
            }
          },
          error: function () {
            alert('서버와의 통신 중 오류가 발생했습니다.');
            isIdChecked = false;
          }
        });
      });

      // 아이디 입력값이 바뀌면 중복확인 다시 하도록 초기화
      $('.chk_id').on('input', function () {
        isIdChecked = false;
        $('.inc_id').hide();
        $('.co_id').hide();
      });

      // 회원가입 폼 제출 전 검사
      $('form').on('submit', function (e) {
        const isPwMatchVisible = $('.co_pw').is(':visible');

        if (!isPwMatchVisible) {
          alert('비밀번호가 일치하지 않습니다.');
          e.preventDefault();
          return false;
        }

        if (!isIdChecked) {
          alert('아이디 중복확인을 해주세요!');
          e.preventDefault();
          return false;
        }
      });
    });
  </script>
</head>
<body class="pretendard">

<div th:replace="layout/header :: header"></div>

<div class="center_box color_white">
  <h2 class="my_title">회원가입</h2>
  <form action="/joinProcess" method="post">
    <div class="join_box">
      <p>Name</p>
      <div class="join_input">
        <input type="text" name="customerName" value="" placeholder="Your Name" required>
      </div>
    </div>
    <div class="join_box">
      <p>ID</p>
      <div class="join_input flex_input">
        <input type="text" name="customerId" value="" placeholder="ID" class="chk_id" required>
        <button type="button" class="chk_id_btn">중복확인</button>
      </div>
      <div class="rep">
        <p class="inc_id">이미 등록된 ID 입니다.</p>
        <p class="co_id">사용 가능한 ID 입니다.</p>
      </div>
    </div>
    <div class="join_box">
      <p>Password</p>
      <div class="join_input">
        <input type="password" name="customerPass" value="" placeholder="Password" class="ori_pw" required>
      </div>
    </div>
    <div class="join_box">
      <p>Password Check</p>
      <div class="join_input">
        <input type="password" name="" value="" placeholder="Password Check" class="chk_pw" required>
      </div>
      <div class="pw_chk">
        <p class="inc_pw">비밀번호가 일치하지 않습니다.</p>
        <p class="co_pw">비밀번호가 일치합니다.</p>
      </div>
    </div>
    <div class="join_box">
      <p>E-mail</p>
      <div class="email_input">
        <input type="text" name="customerEmail" value="" placeholder="E-mail" required>
      </div>
    </div>
    <div class="join_box">
      <p>Address</p>
      <div class="join_input">
        <input type="text" name="customerAddr" value="" placeholder="배송지 입력" required>
      </div>
    </div>
    <div class="join_box">
      <p>Phone</p>
      <div class="join_input">
        <input type="tel" name="customerPhone" value="" placeholder="Phone Number" required>
      </div>
    </div>
    <button type="submit" class="s_btn">회원가입</button>
  </form>
</div>

<div th:replace="layout/footer :: footer"></div>

</body>
</html>